Unity Cloud Build TeamCity Bridge
===
### v0.0.1

Processes webhooks from Unity Cloud builds and triggers Teamcity builds.

This is useful for generating a wrapping server or service in Teamcity for Unity Cloud webgl builds.

It is built on `koa`, processed via `babel`, bundled with `webpack` and served by `nodemon`

### How do I get setup?

`npm install`

### How do I run the server locally?

`npm run watch` - will update source code as you save it
`npm start` - will start the koa server

### How do I run it as a container?

```
docker run -v /path/to/config.json:/home/dubit/app/config/projects.json \
	-e UNITY_ACCESS_KEY=xxxxxx \
	-e TEAMCITY_URL='http://teamcityserver.com -e \
	-e TEAMCITY_USER=myuser \
	-e TEAMCITY_PASS=pwd
```

### How do I add project config?

This service uses a json file to match webhooks it receives from Unity Cloud to the builds it should trigger on Team City.

By default the server reads config from`PROJECTROOT/coonfig/project.json`, this can be changed by setting `${PROJECT_CONFIG_PATH}`

When running as a docker container you will want to mount the json file to the above path as a volume. `-v /path/to/config.json:/home/dubit/app/config/projects.json`

The configuration is an array of simple objects that represent a project, with details of the unity cloud build and the teamcity build configuration.

The values for a project are:
`uuid` - The uuid of the project in Unity Cloud
`targetName` - The build target from Unity Cloud
`teamcity_id` - The build configuration to trigger in teamcity

example config file:
```
[{
  "uuid": "aff01d2-2aed-0xf1-b920-ef4aa8713e3",
  "targetName": "Development - WEGBGL",
  "teamcity_id": "webgl_express_build_config"
}]
```


### Environment Variables

#### Server Options

**PORT** (optional)
Default: `8080`
Sets the port that the server will listen on, **If you change from the default you will need to expose it`-p xx:yy`**

#### Unity Cloud


**UNITY_ACCESS_KEY** (required)

The key with which to access the unity cloud API, it will be limited to the privleges of the account it is generated by.

You can generate a key in your Unity Cloud [user preferences](https://build.cloud.unity3d.com/preferences/)

**UNITY_CLOUD_URL** (optional)
Default: `https://build-api.cloud.unity3d.com`
Sets the destination for unity cloud API calls

#### Team City

**TEAMCITY_URL** (required)

Sets the destination of TeamCity API calls, point it at the REST API endpoint of your teamcity setup
e.g. `http://teamcity:8111/`

For more information on the Team City API [see here](https://confluence.jetbrains.com/display/TCD10/REST+API#RESTAPI-Generalinformation)

**TEAMCITY_USER** (required)

The username of the user that will be used to authenticate against the Team City API

Note: This user will need to have enough permissions to trigger a build on the relevant projects

**TEAMCITY_PASS** (required)

The password of the specified Team City User